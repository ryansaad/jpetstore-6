---
- name: Deploy Kubernetes Application
  hosts: k8s
  gather_facts: yes

  tasks:
    - name: Copy deployment.yaml to Kubernetes master
      copy:
        src: "{{ workspace }}/deployment.yaml"
        dest: /home/ubuntu/deployment.yaml
      become: yes

    - name: Apply Deployment
      # ⚠️ FIX: Added --validate=false to prevent timeout/connection errors
      command: kubectl apply -f /home/ubuntu/deployment.yaml --kubeconfig=/home/ubuntu/.kube/config --validate=false
